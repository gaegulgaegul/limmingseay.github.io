---
layout: post
title:  "Spring Boot Security + OAuth2"
image: ''
date:   2019-02-05 15:00:00
tags:
- Spring Boot
- TIL
description: ''
categories:
- Spring Boot
---

<br/>
<br/>

## OAuth2
- 토큰을 사용하는 범용적인 방법의 인증을 제공하는 표준 인증 프로토콜
- 3rd party를 위한 범용적인 인증 표준
- 승인 타입
    - 권한 부여 코드 승인 타입
    - 암시적 승인 타입
    - 리소스 소유자 암호 자격 증명 승인 타입
    - 클라이언트 자격 증명 승인 타입
- 가장 많이 사용하는 <code>권한 부여 코드 승인 타입</code>
    - 리소스 접근을 위한 사용자명과 비밀번호, 권한 서버에 요청해서 받은 권한 코드를 함께 활용하여 리소스에 대한 액세스 토큰을 받으면 이를 인증에 이용하는 방식입니다.
    - 페이스북, 카카오 등 소셜 미디어들이 웹서버에서 클라이언트를 지원하는데 사용됩니다.

## 권한 부여 코드 승인 타입(장기 액세스 토큰을 이용한 사용자 인증) 흐름
- 예시를 위해 쇼핑몰에서 권한 정보를 요청하는 상황입니다.
<p>1.  고객은 쇼핑몰의 로그인을 위해 sns계정으로 로그인을 하고 싶어 합니다.</p>
<p>2. 쇼핑몰에서 권한 서버(카카오, 구글, 페이스북 등)에 <code>권한 부여 코드</code>를 요청합니다.</p>
{% highlight javascript %}
권한 부여 코드
    {
        client_id,
        redirect_url,
        response_type: code,
    }
{% endhighlight %}
<p>3. 성공적으로 권한 부여 코드를 받은 쇼핑몰은 <code>액세스 토큰</code>을 권한 서버에 추가로 요청합니다.</p>
{% highlight javascript %}
액세스 토큰으로 권한 부여 코드 요청
    {
        client_id,
        client_secret,
        redirect_id,
        grant_type: authorization_code
    }
{% endhighlight %}
<p>4. 응답받은 액세스 토큰을 사용하여 리소스 서버(구글, 페이스북, 카카오 등)에 고객의 데이터를 요청합니다.</p>
<p>5. OAuth2 방식은 최소 3번 사용자의 정보를 요청하게 됩니다.</p>

### 스프링 부트 시큐리티 + OAuth2 기능 사항

1. 사용자가 애플리케이션에 접속하면 해당 사용자에 대한 <code>이전 로그인 정보의 유무</code>를 체크합니다.
2. 세션에 있는 경우 세션을 사용하고, 없으면 OAuth2 인증 과정을 거치게 된다.
3. <code>이메일을 키값으로 사용하여 이미 가입된 사용자인지 체크</code>합니다. 이미 가입된 사용자라면 등록된 정보를 반환하여 요청한 URL로 접근을 허용하고 아니라면 새롭게 <code>User정보를 저장하는 과정</code>을 진행합니다.
4. 각 소셜 미디어에서 제공하는 User 정보가 다르기 때문에 소셜 미디어에 따라 User 객체를 생성한 후 DB에 저장합니다.