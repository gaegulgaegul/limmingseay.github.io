---
layout: post
title:  "ES6 Promise"
image: ''
date:   2019-02-05 15:00:00
tags:
- Javascript
- TIL
description: ''
categories:
- Javascript
---

<br/>
<br/>

## Promise
- 그 동안 자바스크립트에서 비동기 처리를 위해 콜백 함수를 사용했다.
  비동기 처리를 온전히 할 수 있지만 에러, *예외처리가 어렵고 중첩으로 인한 복잡도가 증가*되었다.

## 예제
- 기본 생성 규칙
{% highlight javascript %}
    const condition = true;
    const promise = new Promise((resolve, reject) => {
        if(condition) {
            resolve('성공');
        } else {
            reject('실패');
        }
    });
    
// 방식1
    promise
        .then((message) => {
            console.log(message);   // 성공(resolve)한 경우 실행
        })
        .catch((error) => {
            console.log(error);  // 실패(reject)한 경우 실행
        });

// 방식2
    promise
    .then((message) => {
        return new Promise((resolve, reject) => {
            resolve(message);
        });
    })
    .then((message2) => {
        console.log(message2);
        return new Promise((resolve, reject) => {
            resolve(message2);
        });
    })
    .then((message3) => {
        console.log(message3);
    })
    .catch((error) => {
        console.log(error);  // 실패(reject)한 경우 실행
    });
{% endhighlight %}

- 콜백을 쓰는 패턴을 프로미스로 전환
{% highlight javascript %}
// 콜백 함수
    function findAndSaveUser(Users) {
        Users.findOne({}, (err, user) => { // 첫번째 콜백
            if(err) {
                return console.error(err);
            }
            user.name = 'zero';
            user.save((err) => { // 두번째 콜백
                if(err) {
                    return console.error(err);
                }
                Users.findOne({ gender: 'm' }, (err, user) => { // 세번째 콜백
                    // 생략
                });
            });
        });
    }

// 프로미스 전환
    function findAndSaveUser(Users) {
        Users.findOne({})
            .then((user) => {
                user.name = 'zero';
                return user.save();
            })
            .then((user) => {
                return Users.findOne({ gender : 'm' });
            })
            .then((user) => {
                // 생략
            })
            .catch(err => {
                console.error(err);
            });
    }
{% endhighlight %}

- Promise.all
{% highlight javascript %}
    const promise1 = Promise.resolve('성공1');
    const promise2 = Promise.resolve('성공2');
    Promise.all([promise1, promise2])
        .then((result) => {
            console.log(result); // ['성공1', '성공2']
        })
        .catch((error) => {
            console.error(err);
        });
{% endhighlight %}